<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <link rel="stylesheet" href="./assets/css/styles.css">
</head>
<body>
    <div style="display:none">
        <include src="./source/assets/img/svg-sprite.svg"></include>
    </div>

    <div id="modal">
        <!--для показа модалки-->
        <button type="button" class="btn-default" 
            style="
                display: flex;
                align-self: center;
                margin: auto;
                padding: 10px;
                border: 1px solid #d0d0d0;
                margin-top: 100px;
            " 
            @click="isModalOpened = true"
        >Показ модалки</button>
        <!---->

        <div class="modal" v-if="isModalOpened" @click="closeModalByOverlayClick">
            <div class="modal__container">
                <div class="modal__header">
                    <h2 class="modal__title">{{modalTitle}}</h2>

                    <button type="button" @click="isModalOpened = false" class="modal__close btn-default">
                        <svg width="18" height="18">
                            <use xlink:href="#icon-close"></use>
                        </svg>
                    </button>
                </div>

                <div class="modal__content">
                    <div class="modal__tabs tab">
                        <ul
                            class="tab__list"
                        >
                            <li
                                v-for="(tab,i) of tabs"
                                :key="'tab_' + i"
                            >
                                <button type="button" 
                                    class="tab__btn btn-default"
                                    :class="tab.isActive ? 'is-active' : null"
                                    @click="onClickChangeTab(tab)"
                                >
                                    {{ tab.name }}
                                </button>
                            </li>
                        </ul>
                    </div>

                    <div class="modal-tab">
                        <div class="tab__controls" v-if="activeTabID === 'tab_2'">
                            <div class="tab__controls-top">
                                <div class="tab__controls-filter-container">
                                    <transition name="fadeIn">
                                        <div class="tab__filter filter" v-if="isFilterOpened">
                                            <form action="">

                                                <fieldset>
                                                    <label for="rangeFrom">Расстояние (км):</label>
                                                    <div>
                                                        <input type="text" placeholder="от" id="rangeFrom" name="rangeFrom">
                                                        <input type="text" placeholder="до" name="rangeTo">

                                                        <div class='range'>
                                                            <div class="range__body">
                                                                <div class="range__inner"></div>

                                                                <div class="range__thumb range__thumb--left" tabindex="0"  @mousedown="onMouseOver"></div>
                                                                <div class="range__thumb range__thumb--right" tabindex="0" @mousedown="onMouseOver"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </fieldset>

                                                <fieldset>
                                                    <label for="area">Общая площадь (м2):</label>
                                                    <div>
                                                        <input type="text" placeholder="от" id="area" name="areaFrom">
                                                        <input type="text" placeholder="до" name="areaTo">
                                                    </div>
                                                </fieldset>

                                                <fieldset>
                                                    <label for="kitchenArea">Площадь кухни (м2):</label>
                                                    <div>
                                                        <input type="text" placeholder="от" id="kitchenArea" name="kitchenAreaFrom">
                                                        <input type="text" placeholder="до" id="kitchenAreaTo">
                                                    </div>
                                                </fieldset>
                                            </form>
                                        </div>
                                    </transition>

                                    <div class="tab__filter-controls">
                                        <button 
                                            type="button" 
                                            class="tab__controls-filter-btn btn-default"
                                            @click="isFilterOpened = !isFilterOpened"
                                        >
                                            {{!isFilterOpened ? 'Уточнить' : 'Свернуть'}}
                                        </button>

                                        <button 
                                            type="button" 
                                            class="tab__controls-filter-btn tab__controls-filter-btn--green btn-default"
                                            v-if="isFilterOpened"
                                        >
                                            Применить
                                        </button>
                                    </div>
                                </div>

                                <div class="tab__controls-toggler-container">
                                    <button 
                                        type="button" 
                                        class="tab__controls-toggler btn-default"
                                        :class="viewType === 'list' ? 'is-active' : null"
                                        @click=" viewType = 'list' "
                                    >
                                        Списком
                                    </button>
                                    <button 
                                        type="button" 
                                        class="tab__controls-toggler btn-default"
                                        :class="viewType === 'map' ? 'is-active' : null"
                                        @click=" viewType = 'map' "
                                    >
                                        На карте
                                    </button>
                                </div>
                            </div>

                            <div class="tab__controls-bottom">
                                <button 
                                    type="button" 
                                    class="btn-default tab__controls-average-btn"
                                    @click="isAverageModalOpened = !isAverageModalOpened"
                                >
                                    <svg width="18" height="18">
                                        <use xlink:href="#icon-chart"></use>
                                    </svg>
                                    <span>Показать средние цены</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="modal__body">
                        <div class="" v-if="viewType === 'list'">
                            Списком
                        </div>
                        <div class="" v-if="viewType === 'map'">
                            На карте
                        </div>
                    </div>
                </div>

                <div class="inner-modal average-modal" v-if="isAverageModalOpened" @click="closeModalByOverlayClick">
                    <div class="inner-modal__container average-modal__container">
                        <div class="modal__header">
                            <h2 class="modal__title">Средние цены</h2>
        
                            <button type="button" @click="isAverageModalOpened = false" class="modal__close btn-default">
                                <svg width="18" height="18">
                                    <use xlink:href="#icon-close"></use>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="inner-modal object-modal" v-if="isObjectModalOpened">
                    <div class="inner-modal__container object-modal__container">
                        Модалка в картах
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var app = new Vue({
            el: '#modal',

            data: {
                /*content*/
                modalTitle: 'Аналитика по конкурентам',

                tabs: [
                    {
                        name: 'В этом доме',
                        id: 'tab_1',
                        isActive: false,
                    },
                    {
                        name: 'В радиусе',
                        id: 'tab_2',
                        isActive: true,
                    },
                    {
                        name: 'По заданной территории',
                        id: 'tab_3',
                        isActive: false,
                    }
                ],
                /*end content*/

                /*engine options*/
                activeTabID: 'tab_2',
                viewType: 'list',
                isModalOpened: true,
                isFilterOpened: true,
                isAverageModalOpened: false,
                isObjectModalOpened: false,
                /*end engine options*/
            },

            methods: {
                closeModalByOverlayClick(evt) {
                    const overlay = document.querySelector('.modal');
                    const averageModalOverlay = document.querySelector('.average-modal');

                    if( evt.target === overlay ) {
                        this.isModalOpened = false;
                    }

                    if(evt.target === averageModalOverlay) {
                        this.isAverageModalOpened = false;
                    }
                },

                onClickChangeTab(tab) {
                    this.tabs.forEach(tab => {
                        tab.isActive = false;
                    });

                    tab.isActive = true;
                    this.activeTabID = tab.id;
                },

                onMouseMove() {
                    console.log('onMouseMove')
                },

                onMouseOver(evt) {
                    console.log('over', evt.target.getBoundingClientRect())

                    evt.target.addEventListener('mousemove', this.onMouseMove);
                }
            },

            watch: {
                isModalOpened: function(oldVal, newVal) {
                    if(newVal === false) {
                        this.isFilterOpened = false;
                        this.isAverageModalOpened = false;
                        isObjectModalOpened = false;
                        this.viewType = 'list';
                        
                        this.tabs.forEach(tab => tab.isActive = false);
                        this.activeTabID = 'tab_2';
                        this.tabs[1].isActive = true;
                    }
                }
            }
        })
    </script>
</body>
</html>